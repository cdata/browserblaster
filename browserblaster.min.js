(function(){var Class=function(methods){var ret=function(){if(methods&&typeof methods.initialize=="function"){return methods.initialize.apply(this,arguments)}};for(var key in methods){if(methods.hasOwnProperty(key)){ret.prototype[key]=methods[key]}}return ret};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null){throw new TypeError()}var t=Object(this);var len=t.length>>>0;if(len===0){return -1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n))}}}if(n>=len){return -1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return -1}}var Vector=new Class({initialize:function(x,y){if(typeof x=="Object"){this.x=x.x;this.y=x.y}else{this.x=x;this.y=y}},cp:function(){return new Vector(this.x,this.y)},mul:function(factor){this.x*=factor;this.y*=factor;return this},mulNew:function(factor){return new Vector(this.x*factor,this.y*factor)},add:function(vec){this.x+=vec.x;this.y+=vec.y;return this},addNew:function(vec){return new Vector(this.x+vec.x,this.y+vec.y)},sub:function(vec){this.x-=vec.x;this.y-=vec.y;return this},subNew:function(vec){return new Vector(this.x-vec.x,this.y-vec.y)},rotate:function(angle){var x=this.x,y=this.y;this.x=x*Math.cos(angle)-Math.sin(angle)*y;this.y=x*Math.sin(angle)+Math.cos(angle)*y;return this},rotateNew:function(angle){return this.cp().rotate(angle)},setAngle:function(angle){var l=this.len();this.x=Math.cos(angle)*l;this.y=Math.sin(angle)*l;return this},setAngleNew:function(angle){return this.cp().setAngle(angle)},setLength:function(length){var l=this.len();if(l){this.mul(length/l)}else{this.x=this.y=length}return this},setLengthNew:function(length){return this.cp().setLength(length)},normalize:function(){var l=this.len();if(l==0){return this}this.x/=l;this.y/=l;return this},normalizeNew:function(){return this.cp().normalize()},angle:function(){return Math.atan2(this.y,this.x)},collidesWith:function(rect){return this.x>rect.x&&this.y>rect.y&&this.x<rect.x+rect.width&&this.y<rect.y+rect.height},len:function(){var l=Math.sqrt(this.x*this.x+this.y*this.y);if(l<0.005&&l>-0.005){return 0}return l},is:function(test){return typeof test=="object"&&this.x==test.x&&this.y==test.y},dot:function(v2){return this.x*v2.x+this.y*v2.y},toString:function(){return"[Vector("+this.x+", "+this.y+") angle: "+this.angle()+", length: "+this.len()+"]"}});var Rect=new Class({initialize:function(x,y,w,h){this.pos=new Vector(x,y);this.size={width:w,height:h}},getRight:function(){return this.pos.x+this.size.width/2},getBottom:function(){return this.pos.y+this.size.height/2}});function now(){return(new Date()).getTime()}function bind(bound,func){return function(){return func.apply(bound,arguments)}}function each(arr,func,bindObject){if(typeof arr.forEach=="function"){return arr.forEach(func,bindObject)}for(var key in arr){if(arr.hasOwnProperty(key)){func.call(bindObject||window,arr[key],key)}}}function addEvent(obj,type,fn){if(obj.addEventListener){obj.addEventListener(type,fn,false)}else{if(obj.attachEvent){obj["e"+type+fn]=fn;obj[type+fn]=function(){obj["e"+type+fn](window.event)};obj.attachEvent("on"+type,obj[type+fn])}}}function removeEvent(obj,type,fn){if(obj.removeEventListener){obj.removeEventListener(type,fn,false)}else{if(obj.detachEvent){obj.detachEvent("on"+type,obj[type+fn]);obj[type+fn]=null;obj["e"+type+fn]=null}}}function elementIsContainedIn(element1,element2){if(element.contains){return element1.contains(element2)}return !!(element1.compareDocumentPosition(element2)&16)}function code(name){var table={38:"up",40:"down",37:"left",39:"right",27:"esc"};if(table[name]){return table[name]}return String.fromCharCode(name)}function random(from,to){return Math.floor(Math.random()*(to+1)+from)}var KickAss=new Class({initialize:function(){this.players=[];this.elements=[];this.bulletManager=new BulletManager();this.bulletManager.game=this;this.explosionManager=new ExplosionManager();this.explosionManager.game=this;this.menuManager=new MenuManager();this.menuManager.game=this;this.menuManager.create();this.lastUpdate=now();this.keyMap={};this.keydownEvent=bind(this,this.keydown);this.keyupEvent=bind(this,this.keyup);addEvent(document,"keydown",this.keydownEvent);addEvent(document,"keyup",this.keyupEvent);addEvent(document,"keypress",this.keydownEvent);this.scrollPos=new Vector(0,0);this.windowSize={width:0,height:0};this.updateWindowInfo()},begin:function(){this.addPlayer();this.loopTimer=window.setInterval(bind(this,this.loop),1000/60)},keydown:function(e){var c=code(e.keyCode);this.keyMap[c]=true;switch(c){case"left":case"right":case"up":case"down":case"esc":case" ":if(e.stopPropogation){e.stopPropogation()}if(e.preventDefault){e.preventDefault()}e.returnValue=false;break}switch(c){case"esc":this.destroy();break}},keyup:function(e){var c=code(e.keyCode);this.keyMap[c]=false;switch(c){case"left":case"right":case"up":case"down":case"esc":case" ":if(e.stopPropogation){e.stopPropogation()}if(e.preventDefault){e.preventDefault()}e.returnValue=false;break}},loop:function(){var currentTime=now();var tdelta=(currentTime-this.lastUpdate)/1000;this.updateWindowInfo();for(var i=0,player;player=this.players[i];i++){player.update(tdelta)}this.bulletManager.update(tdelta);this.explosionManager.update(tdelta);this.lastUpdate=currentTime},addPlayer:function(){var player=new Player();player.game=this;this.players.push(player);this.explosionManager.addExplosion(player.pos)},registerElement:function(el){this.elements.push(el)},unregisterElement:function(el){this.elements.splice(this.elements.indexOf(el),1)},isKickAssElement:function(el){for(var i=0,element;element=this.elements[i];i++){if(el===element||elementIsContainedIn(element,el)){return true}}return false},isKeyPressed:function(key){return !!this.keyMap[key]},updateWindowInfo:function(){var isIEQuirks=(!!window.ActiveXObject)&&document.compatMode=="BackCompat";this.windowSize={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};if(isIEQuirks){this.windowSize.width=document.body.clientWidth;this.windowSize.height=document.body.clientHeight}this.scrollPos.x=window.pageXOffset||document.documentElement.scrollLeft;this.scrollPos.y=window.pageYOffset||document.documentElement.scrollTop},hideAll:function(){for(var i=0,el;el=this.elements[i];i++){el.style.visibility="hidden"}},showAll:function(){for(var i=0,el;el=this.elements[i];i++){el.style.visibility="visible"}},destroy:function(){removeEvent(document,"keydown",this.keydownEvent);removeEvent(document,"keypress",this.keydownEvent);removeEvent(document,"keyup",this.keyupEvent);for(var i=0,player;player=this.players[i];i++){player.destroy()}this.bulletManager.destroy();this.explosionManager.destroy();this.menuManager.destroy();clearInterval(this.loopTimer)}});var MenuManager=new Class({initialize:function(){this.numPoints=0},create:function(){this.container=document.createElement("div");this.container.className="KICKASSELEMENT";with(this.container.style){position="fixed";bottom="20px";right="20px";font="16pt Arial";color="black";zIndex="1000000";textAlign="right"}document.body.appendChild(this.container);this.points=document.createElement("div");this.points.className="KICKASSELEMENT";this.points.style.fontSize="30pt";this.points.innerHTML=this.numPoints;this.container.appendChild(this.points);this.escToQuit=document.createElement("div");this.escToQuit.className="KICKASSELEMENT";this.escToQuit.innerHTML="Press esc to quit";this.container.appendChild(this.escToQuit);this.social=document.createElement("div");this.social.className="KICKASSELEMENT";document.body.appendChild(this.social);with(this.social.style){display="block";position="fixed";top="20px";right="20px";zIndex="100000";textAlign="right"}this.social.innerHTML='<iframe src="http://www.facebook.com/plugins/like.php?href='+encodeURIComponent(window.location.href)+'&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21" scrolling="no" frameborder="0" style="display: block; position: absolute; right: 120px; border:none; overflow:hidden; width:100px; height:21px;" allowTransparency="true"></iframe>'+(/^https/.test(window.location.href)?"":'<a href="http://twitter.com/share" class="twitter-share-button" data-text="I found the secret code and played #browserblaster on '+window.location.href+'. Can you find the code?" data-count="horizontal" data-related="cloudflare:CloudFlare: Performance and Security for Any Website">Tweet</a>');var twitter=document.createElement("script");twitter.type="text/javascript";twitter.src="http://platform.twitter.com/widgets.js";twitter.async=true;this.social.appendChild(twitter);this.game.registerElement(this.container);this.game.registerElement(this.points);this.game.registerElement(this.escToQuit);this.game.registerElement(this.social)},addPoints:function(killed){this.numPoints+=killed*10;this.points.innerHTML=this.numPoints},destroy:function(){this.game.unregisterElement(this.container);this.game.unregisterElement(this.escToQuit);this.game.unregisterElement(this.points);this.container.parentNode.removeChild(this.container)}});var PLAYERIDS=0;var Player=new Class({initialize:function(){this.id=PLAYERIDS++;this.verts=[[-10,10],[15,0],[-10,-10],[-10,10]];this.size={width:20,height:30};this.flames={r:[],y:[]};this.sheet=new Sheet(new Rect(100,100,50,50));this.pos=new Vector(100,100);this.vel=new Vector(0,0);this.acc=new Vector(0,0);this.dir=new Vector(1,0);this.currentRotation=0;this.friction=0.8;this.terminalVelocity=2000;this.lastPos=new Vector(0,0);this.lastFrameUpdate=0;this.generateFlames()},update:function(tdelta){if(this.game.isKeyPressed("left")||this.game.isKeyPressed("right")){if(this.game.isKeyPressed("left")){this.rotateLeft()}if(this.game.isKeyPressed("right")){this.rotateRight()}}else{this.stopRotate()}if(this.game.isKeyPressed("up")){this.activateThrusters()}else{this.stopThrusters()}if(this.currentRotation){this.dir.setAngle(this.dir.angle()+this.currentRotation*tdelta)}var frictionedAcc=this.acc.mulNew(tdelta).sub(this.vel.mulNew(tdelta*this.friction));this.vel.add(frictionedAcc);if(this.vel.len()>this.terminalVelocity){this.vel.setLength(this.terminalVelocity)}this.pos.add(this.vel.mulNew(tdelta));if(now()-this.lastFrameUpdate>1000/15){this.generateFlames()}this.checkBounds();if(!this.lastPos.is(this.pos)||this.currentRotation){this.sheet.clear();this.sheet.setAngle(this.dir.angle());this.sheet.setPosition(this.pos);if(!this.acc.is({x:0,y:0})){this.sheet.drawFlames(this.flames)}this.sheet.drawPlayer(this.verts);this.lastPos=this.pos.cp()}},generateFlames:function(){var rWidth=this.size.width,rIncrease=this.size.width*0.1,yWidth=this.size.width*0.6,yIncrease=yWidth*0.2,halfR=rWidth/2,halfY=yWidth/2,halfPlayerHeight=this.size.height/4;this.flames.r=[[-1*halfPlayerHeight,-1*halfR]];this.flames.y=[[-1*halfPlayerHeight,-1*halfY]];for(var x=0;x<rWidth;x+=rIncrease){this.flames.r.push([-random(2,7)-halfPlayerHeight,x-halfR])}this.flames.r.push([-1*halfPlayerHeight,halfR]);for(var x=0;x<yWidth;x+=yIncrease){this.flames.y.push([-random(2,7)-halfPlayerHeight,x-halfY])}this.flames.y.push([-1*halfPlayerHeight,halfY]);this.lastFrameUpdate=now()},checkBounds:function(){var w=this.game.windowSize.width;var h=this.game.windowSize.height;var rightBound=this.pos.x+this.sheet.rect.size.width/2;var bottomBound=this.pos.y+this.sheet.rect.size.height/2;if(rightBound>w){window.scrollTo(this.game.scrollPos.x+50,this.game.scrollPos.y);this.pos.x=0}else{if(this.pos.x<0){window.scrollTo(this.game.scrollPos.x-50,this.game.scrollPos.y);this.pos.x=w-this.sheet.rect.size.width/2}}if(bottomBound>h){window.scrollTo(this.game.scrollPos.x,this.game.scrollPos.y+h*0.75);this.pos.y=0}else{if(this.pos.y<0){window.scrollTo(this.game.scrollPos.x,this.game.scrollPos.y-h*0.75);this.pos.y=h-this.sheet.rect.size.height/2}}},activateThrusters:function(){this.acc=(new Vector(500,0)).setAngle(this.dir.angle())},stopThrusters:function(){this.acc=new Vector(0,0)},rotateLeft:function(){this.currentRotation=-Math.PI*2},rotateRight:function(){this.currentRotation=Math.PI*2},stopRotate:function(){this.currentRotation=0},destroy:function(){this.sheet.destroy()}});var BulletManager=new Class({initialize:function(){this.bullets={};this.lastFired=0;this.lastBlink=0;this.blinkActive=false;this.enemyIndex=[]},update:function(tdelta){if(this.game.isKeyPressed(" ")&&now()-this.lastFired>100){for(var i=0,player;player=this.game.players[i];i++){this.addBulletFromPlayer(player)}this.lastFired=now()}if(this.game.isKeyPressed("B")){this.blink()}else{this.endBlink()}for(var key in this.bullets){if(this.bullets.hasOwnProperty(key)){var time=now();for(var i=0,bullet;bullet=this.bullets[key][i];i++){if(time-bullet.bornAt>2000){bullet.destroy();this.bullets[key].splice(i,1)}}for(var i=0,bullet;bullet=this.bullets[key][i];i++){bullet.update(tdelta);this.game.hideAll();var hit=bullet.checkCollision();if(hit){this.game.explosionManager.addExplosion(bullet.pos);this.game.menuManager.addPoints(hit.getElementsByTagName("*").length+1);hit.parentNode.removeChild(hit);bullet.destroy();this.bullets[key].splice(i,1)}this.game.showAll()}}}},blink:function(){if(now()-this.lastBlink>250){for(var i=0,el;el=this.enemyIndex[i];i++){if(!this.blinkActive){el.style.outline="1px solid red"}else{el.style.outline=el.KICKASSOLDBORDER}}this.blinkActive=!this.blinkActive;this.lastBlink=now();if(!this.blinkActive){this.updateEnemyIndex()}}},endBlink:function(){if(this.enemyIndex.length){for(var i=0,el;el=this.enemyIndex[i];i++){el.style.outline=el.KICKASSOLDBORDER}this.enemyIndex=[];this.lastBlink=0;this.blinkActive=false}},updateEnemyIndex:function(){var all=document.getElementsByTagName("*");this.enemyIndex=[];for(var i=0,el;el=all[i];i++){if(this.hasOnlyTextualChildren(el)){this.enemyIndex.push(el);el.KICKASSOLDBORDER=el.style.outline||(document.defaultView.getComputedStyle(el,null).outline)}}},addBulletFromPlayer:function(player){var pid=player.id;if(this.bullets[pid]&&this.bullets[pid].length>10){this.bullets[pid][0].destroy();this.bullets[pid].shift()}var bullet=new Bullet();bullet.manager=this;bullet.pos=player.pos.cp();bullet.dir=player.dir.cp();bullet.game=this.game;bullet.vel.add(bullet.vel.cp().setLength(player.vel.len()));if(!this.bullets[pid]){this.bullets[pid]=[]}this.bullets[pid].push(bullet)},hasOnlyTextualChildren:function(element){if(element==document.defaultView||element==document.body){return false}if(element.className&&element.className.indexOf("KICKASSELEMENT")!=-1){return false}for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].childNodes[0]){var children=element.childNodes;for(var i=0,child;child=children[i];i++){if(child.nodeType!=1||child.style.visibility=="hidden"||child.style.display=="none"){continue}if(child.offsetHeight==0||child.offsetWidth==0){continue}if(ELEMENTSTHATCOUNTASTEXTUAL.indexOf(child.tagName)==-1&&ELEMENTSTHATARENOTTOBEINCLUDED.indexOf(child.tagName)==-1){return false}}}}return true},destroy:function(){for(var key in this.bullets){if(this.bullets.hasOwnProperty(key)){for(var i=0,bullet;bullet=this.bullets[key][i];i++){bullet.destroy()}}}this.bullets={}}});var ELEMENTSTHATCOUNTASTEXTUAL=["BR","SELECT","LEGEND"];var ELEMENTSTHATARENOTTOBEINCLUDED=["BR","SCRIPT","STYLE","TITLE","META","HEAD","OPTION","OPTGROUP"];var Bullet=new Class({initialize:function(){this.pos=new Vector(100,100);this.dir=new Vector(1,1);this.vel=new Vector(500,500);this.bornAt=now();this.sheet=new Sheet(new Rect(this.pos.x,this.pos.y,5,5));this.sheet.drawBullet()},update:function(tdelta){this.pos.add(this.vel.setAngle(this.dir.angle()).mulNew(tdelta));this.checkBounds();this.sheet.setPosition(this.pos)},checkCollision:function(){var element=document.elementFromPoint(this.pos.x,this.pos.y);if(element&&element.nodeType==3){element=element.parentNode}return element&&element!=document.documentElement&&this.manager.hasOnlyTextualChildren(element)?element:false},checkBounds:function(){var w=this.game.windowSize.width;var h=this.game.windowSize.height;var rightBound=this.pos.x+this.sheet.rect.size.width/2;var bottomBound=this.pos.y+this.sheet.rect.size.height/2;if(rightBound>w){this.pos.x=0}else{if(this.pos.x<0){this.pos.x=w-this.sheet.rect.size.width/2}}if(bottomBound>h){this.pos.y=0}else{if(this.pos.y<0){this.pos.y=h-this.sheet.rect.size.height/2}}},destroy:function(){this.sheet.destroy()}});var ExplosionManager=new Class({initialize:function(){this.explosions=[]},update:function(tdelta){var time=now();for(var i=0,explosion;explosion=this.explosions[i];i++){if(time-explosion.bornAt>300){explosion.destroy();this.explosions.splice(i,1);continue}explosion.update(tdelta)}},addExplosion:function(pos){var explosion=new Explosion(pos);explosion.game=this.game;explosion.checkBounds();this.explosions.push(explosion)},destroy:function(){for(var i=0,explosion;explosion=this.explosions[i];i++){explosion.destroy()}this.explosions=[]}});var Explosion=new Class({initialize:function(pos){this.bornAt=now();this.pos=pos.cp();this.particleVel=new Vector(400,0);this.generateParticles();this.sheet=new Sheet(new Rect(pos.x,pos.y,250,250))},update:function(tdelta){var vel=this.particleVel.mulNew(tdelta);for(var i=0,particle;particle=this.particles[i];i++){particle.pos.add(particle.vel.mulNew(tdelta).mul(random(0.5,1)).setAngle(particle.dir.angle()))}this.sheet.clear();this.sheet.drawExplosion(this.particles)},generateParticles:function(){this.particles=[];for(var i=0,j=(typeof Raphael!="undefined")?10:40;i<j;i++){this.particles.push({dir:(new Vector(random(0,20)-10,random(0,20)-10)).normalize(),vel:this.particleVel.cp(),pos:new Vector(0,0)})}},checkBounds:function(){var right=this.sheet.rect.getRight();var bottom=this.sheet.rect.getBottom();var w=this.game.windowSize.width;var h=this.game.windowSize.height;if(right>w){this.pos.x-=right-w}if(bottom>h){this.pos.y-=bottom-h}this.sheet.setPosition(this.pos)},destroy:function(){this.sheet.destroy()}});var Sheet=new Class({initialize:function(rect){this.rect=rect;if(typeof Raphael!="undefined"){this.drawer=new SheetRaphael(rect)}else{this.drawer=new SheetCanvas(rect)}},clear:function(){this.drawer.clear()},setPosition:function(pos){this.rect.pos=pos.cp();this.drawer.rect=this.rect;this.drawer.updateCanvas()},setAngle:function(angle){this.drawer.setAngle(angle)},drawPlayer:function(verts){this.drawer.setFillColor("white");this.drawer.setStrokeColor("black");this.drawer.setLineWidth(1.5);this.drawer.tracePoly(verts);this.drawer.fillPath();this.drawer.tracePoly(verts);this.drawer.strokePath()},drawFlames:function(flames){this.drawer.setStrokeColor("red");this.drawer.tracePoly(flames.r);this.drawer.strokePath();this.drawer.setStrokeColor("yellow");this.drawer.tracePoly(flames.y);this.drawer.strokePath()},drawBullet:function(){this.drawer.setFillColor("black");this.drawer.drawCircle(2.5)},drawExplosion:function(particles){for(var i=0,particle;particle=particles[i];i++){this.drawer.setFillColor(["yellow","red"][random(0,1)]);this.drawer.drawLine(particle.pos.x,particle.pos.y,particle.pos.x-particle.dir.x*10,particle.pos.y-particle.dir.y*10)}},destroy:function(){this.drawer.destroy()}});var SheetRaphael=new Class({initialize:function(rect){this.rect=rect;this.fillColor="black";this.strokeColor="black";this.lineWidth=1;this.polyString="";this.raphael=Raphael(this.rect.pos.x-this.rect.size.width/2,this.rect.pos.y-this.rect.size.height/2,this.rect.size.width,this.rect.size.height);this.raphael.canvas.style.zIndex="10000";this.raphael.canvas.className="KICKASSELEMENT";window.KICKASSGAME.registerElement(this.raphael.canvas)},tracePoly:function(verts){if(!verts[0]){return}this.polyString="M"+verts[0][0]+" "+verts[0][1];for(var i=0;i<verts.length;i++){this.polyString+="L"+verts[i][0]+" "+verts[i][1]}},setAngle:function(angle){this.angle=angle},updateCanvas:function(){this.raphael.canvas.width=this.rect.size.width;this.raphael.canvas.height=this.rect.size.height;this.raphael.canvas.style.left=window.KICKASSGAME.scrollPos.x+(this.rect.pos.x-this.rect.size.width/2)+"px";this.raphael.canvas.style.top=window.KICKASSGAME.scrollPos.y+(this.rect.pos.y-this.rect.size.height/2)+"px"},drawLine:function(xFrom,yFrom,xTo,yTo){this.tracePoly([[xFrom,yFrom],[xTo,yTo]]);this.fillPath()},drawCircle:function(radius,pos){pos=pos||{x:0,y:0};this.currentElement=this.raphael.circle(pos.x,pos.y,radius);this.currentElement.attr("fill",this.fillColor)},setFillColor:function(color){this.fillColor=color},setStrokeColor:function(color){this.strokeColor=color},setLineWidth:function(width){this.lineWidth=width},fillPath:function(){this.currentElement=this.raphael.path(this.polyString);this.currentElement.translate(this.rect.size.width/2,this.rect.size.height/2);this.currentElement.attr("fill",this.fillColor);this.currentElement.attr("stroke",this.fillColor);this.currentElement.rotate(Raphael.deg(this.angle),this.rect.size.width/2,this.rect.size.height/2)},strokePath:function(){this.currentElement=this.raphael.path(this.polyString);this.currentElement.attr("stroke",this.strokeColor);this.currentElement.attr("stroke-width",this.lineWidth);this.currentElement.translate(this.rect.size.width/2,this.rect.size.height/2);this.currentElement.rotate(Raphael.deg(this.angle),this.rect.size.width/2,this.rect.size.height/2)},clear:function(){this.raphael.clear()},destroy:function(){window.KICKASSGAME.unregisterElement(this.raphael.canvas);this.raphael.remove()}});var SheetCanvas=new Class({initialize:function(rect){this.canvas=document.createElement("canvas");this.canvas.className="KICKASSELEMENT";with(this.canvas.style){position="absolute";zIndex="1000000"}window.KICKASSGAME.registerElement(this.canvas);if(this.canvas.getContext){this.ctx=this.canvas.getContext("2d")}this.rect=rect;this.angle=0;this.updateCanvas();(document.body).appendChild(this.canvas)},tracePoly:function(verts){if(!verts[0]){return}this.ctx.save();this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2);this.ctx.rotate(this.angle);this.ctx.beginPath();this.ctx.moveTo(verts[0][0],verts[0][1]);for(var i=0;i<verts.length;i++){this.ctx.lineTo(verts[i][0],verts[i][1])}this.ctx.restore()},setAngle:function(angle){this.angle=angle},updateCanvas:function(){if(this.canvas.width!=this.rect.size.width){this.canvas.width=this.rect.size.width}if(this.canvas.height!=this.rect.size.height){this.canvas.height=this.rect.size.height}this.canvas.style.left=window.KICKASSGAME.scrollPos.x+(this.rect.pos.x-this.rect.size.width/2)+"px";this.canvas.style.top=window.KICKASSGAME.scrollPos.y+(this.rect.pos.y-this.rect.size.height/2)+"px"},drawLine:function(xFrom,yFrom,xTo,yTo){this.ctx.save();this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2);this.ctx.beginPath();this.ctx.moveTo(xFrom,yFrom);this.ctx.lineTo(xTo,yTo);this.ctx.lineTo(xTo+2,yTo+2);this.ctx.closePath();this.ctx.fill();this.ctx.restore()},drawCircle:function(radius,pos){pos=pos||{x:0,y:0};this.ctx.save();this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2);this.ctx.arc(0,0,radius,0,Math.PI*2,true);this.ctx.restore();this.ctx.fill()},setFillColor:function(color){this.ctx.fillStyle=color},setStrokeColor:function(color){this.ctx.strokeStyle=color},setLineWidth:function(width){this.ctx.lineWidth=width},fillPath:function(){this.ctx.fill()},strokePath:function(){this.ctx.stroke()},clear:function(){this.ctx.clearRect(0,0,this.rect.size.width,this.rect.size.height)},destroy:function(){window.KICKASSGAME.unregisterElement(this.canvas);this.canvas.parentNode.removeChild(this.canvas)}});var initKickAss=function(){if(!window.KICKASSGAME){window.KICKASSGAME=new KickAss();window.KICKASSGAME.begin()}else{window.KICKASSGAME.addPlayer()}};if(!document.createElement("canvas").getContext){var script=document.createElement("script");script.setAttribute("type","text/javascript");script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){initKickAss()}};script.onload=initKickAss;script.src="http://cdnjs.cloudflare.com/ajax/libs/raphael/1.5.2/raphael-min.js";document.getElementsByTagName("head")[0].appendChild(script)}else{initKickAss()}})();